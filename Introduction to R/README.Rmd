---
title:    "Introduction to R"
author:   "fatemeh.torabi@pace.cam.ac.uk"
always_allow_html: true
---

# Preamble 

In this intro we take you through a focused approach for using R to generate data visualization elements from simulated data, this precise focus aims to enable you to use R more comfortably for your data visualization approaches. We will cover: 

* Installation
* Set up
* Data visualisation
* Line plots
* Area graph
* Scatter plots
* Animated graphs



# Installing R & RStudio

## Install R
R is the programming language you'll be using.
Go to: https://cran.r-project.org
Click on your operating system: 

* Windows → Click "Download R for Windows" → "base" → then click the .exe file to download.

* macOS → Click "Download R for (Mac) OS X" → choose the .pkg file and install.

* Linux → Follow instructions relevant to your Linux distribution.

## Install RStudio (Recommended IDE)
RStudio is a user-friendly interface for R. Note that R must be installed before RStudio. 

Go to: https://posit.co/download/rstudio-desktop/

* Download the free version of RStudio Desktop for your OS.

* Install it.

* Run the installer and follow the default installation steps.

## Installing required packages

Open RStudio, you can run the following script to install the recommended set of packages. These are widely used for data analysis and report writing.
 

`install.packages(c("tidyverse", "ggplot2", "dplyr", "rmarkdown", "knitr"))`

## Posit Cloud
Alternatively you can use all of the codes we provide to you here on a cloud version of R. For this:

* Go to: https://posit.cloud

* Click Sign Up (use your email, Google, GitHub, etc.)or Log In if you already have an account.

* Once logged in, click "New Project". This opens an RStudio environment in your browser — no installation needed.

# Set up

The following code chunk includes the required packages in this EDA. 

```{r setup, echo=TRUE, eval=TRUE, message=FALSE}
knitr::opts_chunk$set(echo = TRUE)

if(!require(tidyverse)) install.packages("tidyverse", repos = "http://cran.us.r-project.org")
if(!require(knitr)) install.packages("knitr", repos = "http://cran.us.r-project.org")
if(!require(DT)) install.packages("knitr", repos = "http://cran.us.r-project.org")
if(!require(plotly)) install.packages("plotly")
if(!require(ggplot2)) install.packages("ggplot2")
if(!require(dplyr)) install.packages("dplyr")
if(!require(ggplot2)) install.packages("ggplot2")
if(!require(gapminder)) install.packages("gapminder")
if(!require(gganimate)) install.packages("gganimate")
if(!require(ggalluvial)) install.packages("ggalluvial")

# Load
library(tidyverse)
library(knitr)
library(DT)
library(plotly)
library(ggplot2)
library(dplyr)
library(gapminder)
library(ggalluvial)

```

# Data Visualisation 

Creating data visualisation elements in R empowers you to explore, communicate, and understand complex patterns in large scale data with clarity and precision.

Through powerful packages like ggplot2, R enables the transformation of raw numbers into meaningful, customisable visuals and reproducible data visualistion elements. From simple line plots to interactive graphs and dashboards. 

This visual storytelling enhances transparency, supports decision-making, and makes findings accessible to diverse audiences, including those without technical backgrounds.

# Line plot

```{r, echo=FALSE, fig.width=6, fig.height=4, fig.align='center'}
library(ggplot2)
library(dplyr)
library(viridis)

# Convert month numbers to names
airquality <- airquality %>%
  mutate(Month = factor(Month, 
                        levels = 5:9, 
                        labels = c("May", "June", "July", "August", "September")))

# Plot with actual month names
p <- ggplot(
  data = airquality,
  aes(Day, Temp, group = Month, color = Month)
  ) +
  geom_line() +
  scale_color_viridis_d() +
  labs(x = "Day of Month", y = "Temperature", color = "Month") +
  theme(legend.position = "top")

p


```


## interactive line plot 

```{r, echo=FALSE, fig.width=6, fig.height=4, fig.align='center'}
ggplotly(p)
```


# Area graph

```{r, echo=FALSE, fig.width=6, fig.height=4, fig.align='center'}
a <- ggplot(data=gapminder, aes(x=lifeExp, fill=continent)) +
    geom_density(alpha=0.3)+
  labs(x = "Life expectency", y = "Density") +
  theme(legend.position = "top")

a
```

```{r, echo=FALSE, fig.width=6, fig.height=4, fig.align='center'}
ggplotly(a)
```

# Scatterplots

```{r, echo=FALSE}
p <- ggplot(data=iris, aes(Petal.Length,Sepal.Length)) +
geom_point(aes(color=Species)) + 
ggtitle("Petal Length vs Sepal Length")+
scale_color_viridis_d()

ggplotly(p)

```

# Interactive plots

```{r GapmScatLine,echo=FALSE, warning=FALSE}
g <- crosstalk::SharedData$new(gapminder, ~continent)
gg <- ggplot(g, aes(gdpPercap, lifeExp, color = continent, frame = year)) +
  geom_point(aes(size = pop, ids = country)) +
  geom_smooth(se = FALSE, method = "lm") +
  scale_x_log10()+
  theme(legend.position = "top")

ggplotly(gg) %>% 
  highlight("plotly_hover")

```

# Animated graphs

Sometimes even with interactive graphs, the picture is not complete. Adding movements to a complex graph can help make the relationship between the variables more transparent and add more meaning to the graphs. To achieve this, we use animations.  

```{r, echo=FALSE}
# libraries:
library(ggplot2)
library(gganimate)

p <- ggplot(
  gapminder, 
  aes(x = gdpPercap, y=lifeExp, size = pop, colour = country)
  ) +
  geom_point(show.legend = FALSE, alpha = 0.7) +
  scale_color_viridis_d() +
  scale_size(range = c(2, 12)) +
  scale_x_log10() +
  labs(x = "GDP per capita", y = "Life expectancy")

p + facet_wrap(~continent)
```


# Bubble graphs
A template bubble graph using the airquality dataset in R.

```{r, echo=FALSE}
airQuality_plot <- 
  ggplot(airquality, aes(x = Day, y = Ozone, 
										color= as.factor(Month),
										text = paste("Month:", Month))) +
	geom_point(size = airquality$Wind) +
	ggtitle("Air Quality in New York by Day") +
	labs(x = "Day of the month", y = "Ozone (ppb)", color="Month") +
	scale_color_viridis_d()+
  #scale_x_continuous(breaks = seq(1, 31, 5))+
	scale_size(range = c(1, 10))

#creating the interactive version
ggplotly(airQuality_plot, tooltip=c("text","x","y"))

```

# River plots

River plots (also known as Sankey diagrams or alluvial plots) are useful for visualizing flow or transition between categories over time. Here's how to create an alluvial/river plot using the gapminder dataset in R with the ggalluvial package. Click to maximise the plot. 

This type of plots are highly relevant when you are investigating concepts such as disease progression where patients might move from one state to a more advance state of their disease throughout their life course. 

```{r, echo=FALSE, fig.width=10, fig.align='left', fig.height=6}
# Step 1: Create income group and filter for target years
gap_filtered <- gapminder %>%
  filter(year %in% c(1962, 1982, 2002)) %>%
  mutate(income_group = case_when(
    gdpPercap < 1000 ~ "Low",
    gdpPercap < 4000 ~ "Lower-Middle",
    gdpPercap < 12000 ~ "Upper-Middle",
    TRUE ~ "High"
  )) %>%
  select(country, year, income_group)

# Step 2: Pivot to wide format to filter countries with full data
gap_wide <- gap_filtered %>%
  pivot_wider(names_from = year, values_from = income_group)

# Keep only countries with complete data
gap_wide <- na.omit(gap_wide)

# Step 3: Pivot back to long format
gap_long <- gap_wide %>%
  mutate(country_id = row_number()) %>%  # unique ID per country
  pivot_longer(cols = c(`1962`, `1982`, `2002`), 
               names_to = "year", 
               values_to = "income_group")

gap_long$year <- factor(gap_long$year, levels = c("1962", "1982", "2002"))

# Step 4: Create river plot
R <- ggplot(gap_long,
       aes(x = year, stratum = income_group, alluvium = country_id, 
           fill = income_group, label = income_group)) +
  geom_flow(stat = "alluvium", lode.guidance = "forward", alpha = 0.6) +
  geom_stratum() +
  scale_fill_manual(values = c(
    "Low" = "#d73027",
    "Lower-Middle" = "#fc8d59",
    "Upper-Middle" = "#91bfdb",
    "High" = "#4575b4"
  )) +
  theme_minimal() +
  labs(title = "Changes in Income Group Over Time",
       subtitle = "Gapminder GDP per capita (selected years)",
       y = "Number of countries",
       fill = "Income Group")

R
```
